# Generate Spring Boot Application

Can you generate a Spring Boot Application using an AI coding assistant?

The code should be production-grade quality.

## Setup
LMStudio, qwen2.5-coder, GPU

## Create Skeleton
The Spring Boot application has the following requirements:
* The Rest API must be defined by means of an OpenAPI specification;
* The controller interface is generated by means of the `openapi-generator-maven-plugin`;
* PostgreSQL is used as database;
* Liquibase is used to create the database tables;
* jOOQ is used to access the database;
* The jOOQ classes must be generated by means of the `testcontainers-jooq-codegen-maven-plugin`.

Navigate to [Spring Initializr](https://start.spring.io/) and add the following dependencies:
* Spring Web
* PostgreSQL Driver
* JOOQ Access Layer
* Validation
* Liquibase Migration

The following changes are applied to the generated Spring Boot application:
* The controller interface must be generated based on the OpenAPI specification, add plugin `openapi-generator-maven-plugin` and dependency `swagger-annotations`;
* Add scope runtime to dependency `liquibase-core`;
* Add a file `db.changelog-root.xml` to `src/main/resources/db/changelog/db.changelog-root.xml` as root file for the Liquibase migration scripts;
* The jOOQ classes should be generated, add plugin `testcontainers-jooq-codegen-maven-plugin`;
* Remove the test from the test sources.

The changes are applied to branch [feature/base-repository](https://github.com/mydeveloperplanet/myaicodeprojectplanet/tree/feature/base-repository).

Run the build.
```shell
mvn clean verify
```

The build fails because the OpenAPI specification is missing. However, this is the starting point.

## Generate OpenAPI Specification
The build fails on the OpenAPI specification which is missing. So, let's first fix this.

### Prompt
Enter the prompt.
```text
Generate an OpenAPI specification version 3.1.1. 
The spec should contain CRUD methods for customers. 
The customers have a first name and a last name. 
Use the Zalando restful api guidelines.
```
### Response
The response can be viewed [here](responses/1-generate-openapi-spec.md).

### Apply Response
Add the response to file [src/main/resources/static/customers.yaml](https://github.com/mydeveloperplanet/myaicodeprojectplanet/blob/feature/add-openapi-spec/src/main/resources/static/customers.yaml).

Additionally, change the following.
* Change the identifiers from strings to integers;
* Add the identifier to the Customer schema, this way the identifier will be returned in the responses.
```yaml
components:
  schemas:
    Customer:
      type: object
      properties:
        id:
          type: integer
          format: int64
        firstName:
          type: string
        lastName:
          type: string
```

Run the build. The build is successful and in directory `target/generated-sources/openapi` the generated sources are available.

The build shows some warnings, but these can be fixed by adding an `operationId` to the OpenAPI specification. For now, the warnings are ignored.
```shell
[WARNING] Empty operationId found for path: GET /customers. Renamed to auto-generated operationId: customersGET
[WARNING] Empty operationId found for path: POST /customers. Renamed to auto-generated operationId: customersPOST
[WARNING] Empty operationId found for path: GET /customers/{id}. Renamed to auto-generated operationId: customersIdGET
[WARNING] Empty operationId found for path: PUT /customers/{id}. Renamed to auto-generated operationId: customersIdPUT
[WARNING] Empty operationId found for path: DELETE /customers/{id}. Renamed to auto-generated operationId: customersIdDELETE
```

The changes can be viewed [here](https://github.com/mydeveloperplanet/myaicodeprojectplanet/tree/feature/add-openapi-spec).

## Generate Liquibase Scripts
In this section the Liquibase scripts will be generated.

### Prompt
Open the OpenAPI spec and enter the prompt.
```text
Based on this openapi spec, generate liquibase migration scripts in XML format
```

### Response
The response can be viewed [here](responses/2-generate-liquibase.md).

### Apply Response
The generated XML Liquibase script is entirely correct. Create in directory `src/main/resources/db/changelog/migration` a file `db.changelog-1.xml` and copy the response into it. Besides that, change the author to `mydeveloperplanet`.
```xml
<changeSet id="1" author="mydeveloperplanet">
```

Run the build.

The build log shows that the tables are generated.
```shell
Feb 23, 2025 12:42:59 PM liquibase.changelog
INFO: Reading resource: src/main/resources/db/changelog/migration/db.changelog-1.xml
Feb 23, 2025 12:42:59 PM liquibase.changelog
INFO: Creating database history table with name: public.databasechangelog
Feb 23, 2025 12:42:59 PM liquibase.changelog
INFO: Reading from public.databasechangelog
Feb 23, 2025 12:42:59 PM liquibase.command
INFO: Using deploymentId: 0310979670
Feb 23, 2025 12:42:59 PM liquibase.changelog
INFO: Reading from public.databasechangelog
Running Changeset: src/main/resources/db/changelog/migration/db.changelog-1.xml::1::yourname
Feb 23, 2025 12:42:59 PM liquibase.changelog
INFO: Table customers created
Feb 23, 2025 12:42:59 PM liquibase.changelog
```

In directory `target/generated-sources/jooq` you can find the generated jOOQ files which are generated also.

The changes can be viewed [here](https://github.com/mydeveloperplanet/myaicodeprojectplanet/tree/feature/add-liquibase-scripts).